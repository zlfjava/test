<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<script src="../../js/global.js"></script>
	</head>
	<body>
		<div class="x-nav">
			<span class="layui-breadcrumb">
		        <a href="">首页</a>
		        <a href="">学生管理</a>
		        <a><cite>分量操作</cite></a>
	        </span>
			<a class="layui-btn layui-btn-small" id="Shuaxin" style="line-height:1.6em;margin-top:3px;float:right" href="javascript:location.replace(location.href);" title="刷新">
				<i class="layui-icon" style="line-height:38px">&#xe669;</i>
			</a>
		</div>
		
		<!--tab选项卡-->
		<div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
			<ul class="layui-tab-title">
				<li class="layui-this">分量操作</li>
				<li>分量设置</li>
			</ul>
			<div class="layui-tab-content" style="height: 100px;">
				<div class="layui-tab-item layui-show">
					<!--开启全部分量的按钮-->
					<div class="layui-input-inline">
						<form class="layui-form" action="" id="editForm">
							<div class="layui-form-item" style="width: 300px;">
								<label class="layui-form-label" style="width: 150px;">全部开启自动分量:</label>
								<div class="layui-input-block">
									<input type="checkbox" name="switch" id="PLedit" lay-filter="isFenpei" lay-skin="switch" lay-text="是|否">
								</div>
							</div>
						</form>
					</div>
					<!-- 条件查询区 -->
					<div class="layui-input-inline">
						<form class="layui-form" action="">
							<div class="layui-form-item">
								<label class="layui-form-mid">姓名：</label>
								<div class="layui-input-inline" style="width: 200px;">
									<input type="text" id="loginnameSearch" placeholder="姓名关键字" autocomplete="off" class="layui-input">
								</div>
								<div class="layui-input-inline" style="width: 100px;">
									<button class="layui-btn" type="button" id="searsh">
								        <i class="layui-icon">&#xe615;</i>检索
								    </button>
								</div>
							</div>
						</form>
					</div>
					<!--数据表格-->
					<table id="demo" lay-filter="test"></table>
				</div>
				<!--第二个tab选项卡-->
				<div class="layui-tab-item">
					<!--咨询师姓名条件查询区 -->
					<div class="layui-form-item" style="margin-left: 10px;">
						<form class="layui-form" action="">
							<label class="layui-form-mid">咨询师：</label>
							<div class="layui-input-inline" style="width: 120px;">
								<input type="text" id="loginNameZxs" placeholder="姓名关键字" autocomplete="off" class="layui-input">
							</div>
							<label class="layui-form-mid" style="margin-left: 5px;"></label>
							<div class="layui-input-inline">
								<button class="layui-btn" type="button" id="searshZxs">
							        <i class="layui-icon">&#xe615;</i>检索
							    </button>
							</div>
						</form>
					</div>
					<!--咨询师信息数据表格-->
					<table id="demoZxsTable" lay-filter="demoZxsTable"></table>
				</div>
			</div>
		</div>

		<!-- 是否锁定 滑动按钮 -->
		<script type="text/html" id="switchSuoDing">
			<input type="checkbox" class="check_lockUser" value="{{d.uid}}" lay-skin="switch" lay-text="是|否" lay-filter="isSuoDing" {{d.uifweight=='是' ? 'checked' : '' }}>
		</script>
		
		<!--编辑-->
		<div id="editDiv" style="display: none; margin-top: 10px;">
			<form class="layui-form" id="editQzForm" lay-filter="editQzForm">
				<!--客户id主键  根据id修改-->
				<input type="text" name="uid" id="uid" style="display: none;" class="layui-input">
				<input type="text" name="uweight" id="uweight" style="display: none;" class="layui-input">
				<div class="layui-form-item" style="margin-left: 33px;">
					<label class="layui-form-mid">客户姓名：</label>
					<div class="layui-input-inline">
						<input type="text" name="loginname" id="loginname" readonly="readonly" required lay-verify="required" placeholder="请输入客户姓名" autocomplete="off" class="layui-input">
					</div>
				</div>
				<div class="layui-form-item" style="margin-left: 33px;">
					<label class="layui-form-mid">权重：</label>
					<div class="layui-input-inline">
						<div id="slideTest14" style="margin: 45px 30px; display: inline-block;"></div>
					</div>
				</div>
				<div class="layui-form-item" id="deitBtnDiv" style="margin-left: 90px;">
					<label class="layui-form-mid"></label>
					<div class="layui-input-inline">
						<button class="layui-btn" lay-submit lay-filter="editBtn"><i class="layui-icon">&#xe605;</i>提交</button>
					</div>
				</div>
			</form>
		</div>

		<script type="text/html" id="barDemo">
			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
		</script>

		
		<script>
			layui.use(['table', 'form', 'layer', 'laydate', 'element', 'upload', 'slider'], function() {
				var table = layui.table;
				var form = layui.form;
				var layer = layui.layer;
				var laydate = layui.laydate;
				var upload = layui.upload;
				var slider = layui.slider;
				var $ = layui.$;

				//渲染数据表格
				table.render({
					elem: '#demo',
					url: globalData.server + "/users/getAllWlzxs",
					method: 'post',
					page: true,
					limit: '10',
					where: {
						"uid": "flcz:wlzxsgetAll",
						'token': globalData.getToken()
					}, //验证
					toolbar: '#toolbarDemo', //开启头部工具栏，并为其绑定左侧模板
					cols: [[
						{type: 'checkbox'},
						{type: 'numbers',title: '序号',align: 'center'},
						{field: 'loginname',title: '网络咨询',align: 'center'},
						{field: 'protectmtel',title: '网络咨询师手机号',align: 'center',
							//自定义模板，截取手机号前三位和后四位 中间显示*
							templet: function(d) {
								return d.protectmtel == null || d.protectmtel == '' ? '' : d.protectmtel.substring(0, 3) + "****" + d.protectmtel.substring(7, d.protectmtel.length);
							}
						},
						{field: 'uifweight',title: '是否自动分量',align: 'center',templet: '#switchSuoDing'}
					]],
					id: "reloadId"
				});

				//监听是否自动分量
				form.on('switch(isSuoDing)', function(data) {
					var name = $("#PLedit").val();
					var id = data.value;
					if(data.elem.checked == true) {
						var status = "是";
					} else {
						var status = "否";
					}
					var editUrl = globalData.server + "/users/edituIfweight";
					var strData = {
						"uid": id,
						"uifweight": status,
						"token": globalData.getToken()
					}
					$.post(editUrl, strData, function(res) {
						if(res > 0) {
							if(status == "是") {
								layer.msg("已开启", {icon: 1});
							} else {
								layer.msg("已关闭", {icon: 1});
							}
							table.reload("reloadId", {where: {"token": globalData.getToken()}});
							abcd.qwer(); //重新设置全部自动分量开关的状态
						} else {
							layer.msg("状态错误", {icon: 2});
						}
					}, "json");
				});

				/**
				 * 设置是否全部自动分量开关的状态
				 */
				abcd = {
					qwer: function() {
						var PLeditUrl = globalData.server + "/users/getCountFou";
						var PLstrData = {
							"token": globalData.getToken()
						}
						$.post(PLeditUrl, PLstrData, function(res) {
							if(res > 0) {
								$("#PLedit").removeAttr("checked");
							} else {
								$("#PLedit").prop("checked", "checked");
							}
							layui.form.render();
						}, "json");
					}
				}

				//页面加载时调用  初始化开关状态
				abcd.qwer();

				//监听是否全部开启自动分量
				form.on('switch(isFenpei)', function(data) {
					if(data.elem.checked == true) {
						var status = "是";
					} else {
						var status = "否";
					}
					var editUrl = globalData.server + "/users/editPluIfweight";
					var strData = {
						"uifweight": status,
						"token": globalData.getToken()
					}
					$.post(editUrl, strData, function(res) {
						if(res > 0) {
							if(status == "是") {
								layer.msg("已开启", {icon: 1});
							} else {
								layer.msg("已关闭", {icon: 1});
							}
							table.reload("reloadId", {
								where: {
									"token": globalData.getToken()
								}
							});
						} else {
							layer.msg("状态错误", {icon: 2});
						}
					}, "json");
				});

				//点击检索按钮时触发
				$("#searsh").on("click", function() {
					active.reload();
				});

				/**
				 * 重载数据表格的方法
				 * 参数 loginname loginnameSearch
				 */
				active = {
					reload: function() {
						table.reload("reloadId", {
							where: {
								"loginname": $("#loginnameSearch").val()
							},
							page: {
								curr: 1
							}
						});
					}
				}
				
				//渲染数据表格
				table.render({
					elem: '#demoZxsTable',
					url: globalData.server + "/users/getAllWlzxs",
					method: 'post',
					page: true,
					limit: '10',
					where: {
						'uid': "xsxx:selectRelos",
						'token': globalData.getToken()
					}, //验证
					toolbar: '#toolbarDemoZxs', //开启头部工具栏，并为其绑定左侧模板
					cols: [[
						{type: 'checkbox'},
						{type: 'numbers',title: '序号',align: 'center'},
						{field: 'loginname',title: '咨询师',align: 'center'},
						{field: 'protectmtel',title: '网络咨询师手机号',align: 'center',
							//自定义模板，截取手机号前三位和后四位 中间显示*
							templet: function(d) {
								return d.protectmtel == null || d.protectmtel == '' ? '' : d.protectmtel.substring(0, 3) + "****" + d.protectmtel.substring(7, d.protectmtel.length);
							}
						},
						{title: '操作',align: 'center',toolbar: '#barDemo'} //这里的toolbar值是模板元素的选择器
					]],
					id: "reloadIdZxs"
				});
				
				//监听工具条 
				table.on('tool(demoZxsTable)', function(obj) { //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
					var data = obj.data; //获得当前行数据
					var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
					var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
					var qz = data.uweight;
					if(layEvent === 'edit') { //编辑
						form.val("editQzForm", data);
						slider.render({
							elem: '#slideTest14',
							value: qz,
							input: true, //输入框
							change: function(value) {
								console.log(value), //动态获取滑块数值
								$("#uweight").val(value);
							},
							type: 'vertical' //垂直滑块
						});
						layer.open({
							type: 1,
							title: "您正在编辑[" + data.loginname + "]用户的权重",
							offset: '30px',
							anim: 1,
							maxmin: true,
							area: ['650px', '600px'],
							content: $('#editDiv')
						});
					}
				});

				//监听提交   编辑
				form.on('submit(editBtn)', function(data) {
					var editUrl = globalData.server + "/users/editqz"; //请求地址
					var strData = $("#editQzForm").serialize() + "&token=" + globalData.getToken();
					//发异步，把数据提交给java
					$.post(editUrl, strData, function(res) {
						if(res.code > 0) {
							layer.closeAll();
							layer.msg(res.msg, {icon: 1});
							table.reload("reloadIdZxs", {where: {}});
						} else {
							layer.msg(res.msg, {icon: 5});
						}
					}, "json");
					return false;
				});
				
				//点击检索按钮时触发
				$("#searshZxs").on("click", function() {
					activeZxs.reload();
				});

				/**
				 * 重载数据表格的方法
				 * 参数 loginname loginnameSearch
				 */
				activeZxs = {
					reload: function() {
						table.reload("reloadIdZxs", {
							where: {
								"loginname": $("#loginNameZxs").val()
							},
							page: {
								curr: 1
							}
						});
					}
				}

				//layui.use的括号
			});
		</script>
	</body>

</html>